# VeilWarden veil CLI configuration with sandbox enabled
# Location: ~/.veilwarden/config.yaml

# API routes for secret injection
routes:
  # OpenAI API
  - host: api.openai.com
    secret_id: OPENAI_API_KEY
    header_name: Authorization
    header_value_template: "Bearer {{secret}}"

  # Anthropic API
  - host: api.anthropic.com
    secret_id: ANTHROPIC_API_KEY
    header_name: x-api-key
    header_value_template: "{{secret}}"

  # GitHub API
  - host: api.github.com
    secret_id: GITHUB_TOKEN
    header_name: Authorization
    header_value_template: "token {{secret}}"

# Optional: OPA policy enforcement
# Requires OPA policies to be installed in the policy_path directory
policy:
  enabled: true
  engine: opa
  policy_path: ~/.veilwarden/policies
  decision_path: veilwarden/authz/allow

# Optional: Doppler secret management
# Requires DOPPLER_TOKEN environment variable to be set
# Falls back to environment variables if not configured or token missing
# doppler:
#   project: my-project
#   config: dev           # e.g., dev, staging, prod
#   cache_ttl: 5m        # Optional, default 5m

# Sandbox configuration (process and filesystem isolation)
sandbox:
  # Enable sandbox isolation
  enabled: true

  # Backend selection:
  #   auto     - Best available for platform (seatbelt on macOS)
  #   seatbelt - macOS sandbox-exec (built-in, no installation needed)
  #   srt      - Anthropic sandbox-runtime (npm install -g @anthropic-ai/sandbox-runtime)
  backend: auto

  # Working directory for the agent
  # This is where the agent starts and typically has write access
  working_dir: ~/my-project

  # Directories the agent can write to
  # Agent has full read/write access to these paths
  allowed_write_paths:
    - ~/my-project
    - /tmp

  # Directories the agent cannot read
  # Access to these paths is blocked entirely
  denied_read_paths:
    - ~/.ssh
    - ~/.aws
    - ~/.gnupg
    - ~/.doppler
    - ~/.config/gcloud

  # Additional directories the agent can read (optional)
  # By default, the agent can read most system paths except denied_read_paths
  # allowed_read_paths:
  #   - /usr/local/lib/python3

# Security Notes:
#
# What sandbox protects:
# - Prevents reading sensitive files (~/.ssh/, ~/.aws/, etc.)
# - Prevents writing outside allowed directories
# - Strips DOPPLER_TOKEN from child environment
# - Forces all network traffic through the veil proxy
#
# What sandbox does NOT protect:
# - Network access (still goes through veil proxy with OPA policies)
# - Resource exhaustion (CPU, memory, disk)
# - Kernel exploits (depends on backend isolation mechanism)
#
# Best practices:
# - Always block sensitive directories in denied_read_paths
# - Only allow writes to directories the agent actually needs
# - Use Doppler for secrets so agent never sees raw API keys
# - Always configure OPA policies to control network access
#
# Usage:
#   # Run with sandbox (respects config)
#   veil exec -- python agent.py
#
#   # Force enable sandbox (override config)
#   veil exec --sandbox -- python agent.py
#
#   # Force disable sandbox (override config)
#   veil exec --no-sandbox -- python agent.py
#
#   # Verbose output (see sandbox status)
#   veil exec --verbose -- python agent.py
