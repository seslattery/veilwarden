# Veilwarden Configuration for Kubernetes Deployment
# This configuration enables Kubernetes authentication and OPA policy engine

# Kubernetes authentication
kubernetes:
  enabled: auto  # auto-detect K8s environment (set to true/false to force)
  api_server: https://kubernetes.default.svc
  validate_method: tokenreview

# OPA policy engine for fine-grained access control
policy:
  enabled: true
  engine: opa
  policy_path: /etc/veilwarden/policies
  decision_path: veilwarden/authz/allow

# Example routes configuration
routes:
  # GitHub API access
  - upstream_host: api.github.com
    upstream_scheme: https
    secret_id: GITHUB_TOKEN
    inject_header: Authorization
    header_value_template: "token {{secret}}"

  # Stripe API access
  - upstream_host: api.stripe.com
    upstream_scheme: https
    secret_id: STRIPE_SECRET_KEY
    inject_header: Authorization
    header_value_template: "Bearer {{secret}}"

  # Custom internal API
  - upstream_host: internal-api.example.com
    upstream_scheme: https
    secret_id: INTERNAL_API_KEY
    inject_header: X-API-Key
    header_value_template: "{{secret}}"

# Observability configuration
observability:
  metrics:
    enabled: true
    port: 9090
    path: /metrics
  tracing:
    enabled: true
    endpoint: http://jaeger-collector:14268/api/traces
  logging:
    level: info
    format: json
